@import "../styles/tokens.css";

:root {
  /* Alias app variables to TBA tokens */
  --color-bg: var(--tba-color-background);
  --color-surface: var(--tba-color-surface);
  --color-border: var(--tba-color-border);
  --color-text: var(--tba-color-text);
  --color-muted: var(--tba-color-muted);
  --color-accent: var(--tba-color-primary);
  --color-accent-contrast: var(--tba-color-primary-contrast);

  /* Spacing scale */
  --space-2xs: var(--tba-space-4);
  --space-xs: var(--tba-space-8);
  --space-sm: var(--tba-space-12);
  --space-md: var(--tba-space-16);
  --space-lg: var(--tba-space-24);
  --space-xl: var(--tba-space-32);

  /* Radius */
  --radius-sm: var(--tba-radius-sm);
  --radius-md: var(--tba-radius-md);

  /* Typography */
  --font-size-sm: var(--tba-font-size-sm);
  --font-size-base: var(--tba-font-size-base);
  --font-size-lg: var(--tba-font-size-lg);
  --line-height: var(--tba-line-height);

  /* Layout */
  --container-max: 56rem;
}

* { box-sizing: border-box; }
html {
  height: 100%;
  color-scheme: dark;
  overflow-x: hidden;
}
body {
  margin: 0;
  min-height: 100dvh;
  overflow-x: hidden;
  overscroll-behavior-y: none;
  background: radial-gradient(1200px 600px at 50% -10%, #1a2446 0%, var(--color-bg) 60%), var(--color-bg);
  color: var(--color-text);
  font-family: var(--font-sans), ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
  font-size: var(--font-size-base);
  line-height: var(--line-height);
}

.container {
  max-width: var(--container-max);
  margin: 0 auto;
  padding: var(--space-lg) var(--space-md);
  display: grid;
  gap: var(--space-lg);
}

/* Accessibility utilities */
.visually-hidden {
  position: absolute !important;
  width: 1px; height: 1px;
  padding: 0; margin: -1px; overflow: hidden;
  clip: rect(0 0 0 0); white-space: nowrap; border: 0;
}

h1, h2, h3 { margin: 0; }
h1 { font-size: 1.5rem; }
h2 { font-size: 1.125rem; }

.stack-xs > * + * { margin-top: var(--space-xs); }
.stack-sm > * + * { margin-top: var(--space-sm); }
.stack-md > * + * { margin-top: var(--space-md); }
.stack-lg > * + * { margin-top: var(--space-lg); }

.row { display: flex; align-items: center; gap: var(--space-sm); }
.row.between { justify-content: space-between; }
.flex-1 { flex: 1 1 auto; }
.mono { font-variant-numeric: tabular-nums; font-feature-settings: "tnum"; }
.truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.muted { color: var(--color-muted); }

.card {
  background: color-mix(in oklab, var(--color-surface), transparent 10%);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: var(--space-md);
  box-shadow: var(--tba-shadow-1);
}

@media (max-width: 40rem) {
  .card { padding: var(--space-sm); }
}

.label { font-weight: 600; }

.input, .select {
  width: 100%;
  padding: var(--space-xs) var(--space-sm);
  color: var(--color-text);
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
}

textarea.input { min-height: 8rem; resize: vertical; }

.input:focus, .select:focus { outline: var(--tba-focus-width) solid var(--tba-focus-color); outline-offset: 1px; }

.btn {
  appearance: none;
  padding: var(--space-xs) var(--space-md);
  min-height: var(--tba-control-height);
  border-radius: var(--tba-control-radius);
  border: 1px solid var(--tba-btn-primary-border);
  background: var(--tba-btn-primary-bg);
  color: var(--tba-btn-primary-text);
  font-weight: 600;
  transition: background-color var(--tba-duration-fast) ease, transform var(--tba-duration-fast) ease;
}

.btn:disabled { opacity: 0.5; }
.btn:hover { background: var(--tba-btn-primary-bg-hover); }
.btn:active { background: var(--tba-btn-primary-bg-active); transform: translateY(1px); }
.btn.ghost {
  background: var(--tba-btn-secondary-bg);
  color: var(--tba-btn-secondary-text);
  border-color: var(--tba-btn-secondary-border);
}
.btn.ghost:hover { background: var(--tba-btn-secondary-bg-hover); }
.btn.ghost:active { background: var(--tba-btn-secondary-bg-active); transform: translateY(1px); }

.btn.secondary { background: var(--tba-btn-secondary-bg); color: var(--tba-btn-secondary-text); border-color: var(--tba-btn-secondary-border); }
.btn.secondary:hover { background: var(--tba-btn-secondary-bg-hover); }
.btn.secondary:active { background: var(--tba-btn-secondary-bg-active); transform: translateY(1px); }

/* Touch-friendly steppers */
.stepper { min-width: 3rem; min-height: 3rem; font-size: 1.25rem; }

/* Slider */
.slider { -webkit-appearance: none; appearance: none; height: 0.5rem; background: var(--color-border); border-radius: var(--radius-sm); flex: 1 1 auto; }
.slider:focus { outline: var(--tba-focus-width) solid var(--tba-focus-color); outline-offset: 2px; }
.slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: var(--tba-slider-thumb); height: var(--tba-slider-thumb); border-radius: 50%; background: var(--color-accent); border: 2px solid color-mix(in oklab, var(--color-accent), black 20%); }
.slider::-moz-range-thumb { width: var(--tba-slider-thumb); height: var(--tba-slider-thumb); border-radius: 50%; background: var(--color-accent); border: 2px solid color-mix(in oklab, var(--color-accent), black 20%); }

/* Chips */
.chips { flex-wrap: wrap; gap: var(--space-xs); }
.chip {
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--radius-sm);
  border: 1px solid var(--color-border);
  background: var(--color-surface);
  color: var(--color-text);
  font-size: var(--font-size-sm);
  white-space: nowrap;
}
.chip:active { transform: translateY(1px); }
.chip:hover { background: var(--tba-state-hover); }
.chip:focus { outline: var(--tba-focus-width) solid var(--tba-focus-color); outline-offset: 1px; }

/* Pair control */
.pair-ctl { }
.pair-legend { display: grid; grid-template-columns: 1fr auto 1fr; gap: var(--space-sm); align-items: center; font-size: var(--font-size-sm); }
.progress { gap: var(--space-sm); }

.pair {
  display: grid;
  grid-template-columns: 1fr minmax(9rem, 12rem);
  gap: var(--space-sm);
  align-items: center;
}

.pair-labels { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-sm); font-size: var(--font-size-sm); color: var(--color-muted); }

.help { color: var(--color-muted); font-size: var(--font-size-sm); }

.weights { list-style: none; padding: 0; margin: 0; }
.weights li {
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: var(--space-sm);
  align-items: center;
  padding: var(--space-xs) 0;
}
.badge { display: inline-grid; place-items: center; width: 1.75rem; height: 1.75rem; border-radius: 999px; background: var(--color-surface); border: 1px solid var(--color-border); }

.consistency { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: var(--space-sm); align-items: center; }
.hint { grid-column: 1 / -1; margin: 0; color: var(--color-muted); }

.footer { text-align: center; margin-top: var(--space-lg); }

.conflicts {
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  gap: var(--space-xs);
}

.conflicts li {
  padding: var(--space-xs);
  border-radius: var(--radius-sm);
  background: color-mix(in oklab, var(--color-surface), transparent 50%);
}

/* Sticky footer controls */
.sticky-footer {
  position: fixed;
  left: 0; right: 0; bottom: 0;
  padding: var(--space-sm) var(--space-md);
  padding-bottom: calc(var(--space-sm) + env(safe-area-inset-bottom));
  background: color-mix(in oklab, var(--color-bg), black 5%);
  border-top: 1px solid var(--color-border);
  backdrop-filter: blur(8px);
  display: grid; gap: var(--space-sm);
  z-index: 10;
}
.sticky-grid { display: grid; grid-template-columns: 1fr auto auto; gap: var(--space-sm); align-items: center; }
.progressbar { height: 0.5rem; background: var(--color-border); border-radius: var(--radius-sm); overflow: hidden; }
.progressbar > span { display: block; height: 100%; background: var(--color-accent); width: 0%; }

/* Reserve space for footer - more generous padding on mobile */
main.container {
  padding-bottom: calc(10rem + env(safe-area-inset-bottom));
  min-height: 100dvh;
}

/* Bottom sheet */
.sheet { position: fixed; inset: 0; pointer-events: none; z-index: 20; }
.sheet.open { pointer-events: auto; }
.sheet-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.4); opacity: 0; transition: opacity var(--tba-duration-normal) ease; }
.sheet.open .sheet-backdrop { opacity: 1; }
.sheet-panel {
  position: absolute;
  left: 0; right: 0; bottom: 0;
  background: var(--color-surface);
  border-top: 1px solid var(--color-border);
  border-radius: var(--radius-md) var(--radius-md) 0 0;
  transform: translateY(100%);
  transition: transform var(--tba-duration-normal) ease;
  box-shadow: var(--tba-shadow-1);
  max-height: calc(85dvh - env(safe-area-inset-bottom));
  display: flex;
  flex-direction: column;
}
.sheet.open .sheet-panel { transform: translateY(0); }
.sheet-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-sm) var(--space-md);
  border-bottom: 1px solid var(--color-border);
  flex-shrink: 0;
}
.sheet-body {
  padding: var(--space-md);
  overflow-y: auto;
  overflow-x: hidden;
  flex: 1 1 auto;
  overscroll-behavior: contain;
}

@media (max-width: 40rem) {
  .pair { grid-template-columns: 1fr; }
  .pair-labels { display: none; }
  .pair-legend { grid-template-columns: 1fr; gap: var(--space-xs); text-align: center; }

  /* More compact mobile layout */
  .container {
    padding: var(--space-md) var(--space-sm);
    padding-bottom: calc(11rem + env(safe-area-inset-bottom));
  }

  h1 { font-size: 1.25rem; line-height: 1.4; }
  h2 { font-size: 1rem; line-height: 1.4; }

  /* Adjust footer for mobile */
  .sticky-footer {
    padding: var(--space-xs) var(--space-sm);
    padding-bottom: calc(var(--space-xs) + env(safe-area-inset-bottom));
    gap: var(--space-xs);
  }

  .sticky-grid {
    grid-template-columns: 1fr;
    gap: var(--space-xs);
  }

  /* Make buttons more compact on mobile */
  .btn {
    padding: var(--space-xs) var(--space-sm);
    font-size: var(--font-size-sm);
  }

  /* Consistency grid mobile responsive */
  .consistency {
    grid-template-columns: 1fr;
    font-size: var(--font-size-sm);
  }

  /* Smaller badges on mobile */
  .badge {
    width: 1.5rem;
    height: 1.5rem;
    font-size: var(--font-size-sm);
  }

  /* Compact input fields */
  .input, .select {
    padding: var(--space-xs);
    font-size: var(--font-size-base);
  }

  /* More compact chips row */
  .chips {
    gap: var(--space-2xs);
  }

  .chip {
    padding: var(--space-2xs) var(--space-xs);
    font-size: 0.8125rem;
  }

  /* Adjust stepper button sizes */
  .stepper {
    min-width: 2.5rem;
    min-height: 2.5rem;
  }

  /* Stack layouts more tightly */
  .stack-lg > * + * { margin-top: var(--space-md); }
  .stack-md > * + * { margin-top: var(--space-sm); }
}

@media (prefers-reduced-motion: reduce) {
  * { transition: none !important; animation: none !important; }
}
